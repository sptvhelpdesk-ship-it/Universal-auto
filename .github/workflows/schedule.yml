name: Auto Match Sync

on:
  schedule:
    # Runs every 15 minutes from 12:00 UTC (5:30 PM IST) to 20:45 UTC (2:15 AM IST)
    - cron: '*/15 12-20 * * *'
  workflow_dispatch:

jobs:
  run-sync:
    runs-on: ubuntu-latest
    
    # üî• ‡¶è‡¶á ‡¶™‡¶æ‡¶∞‡¶Æ‡¶ø‡¶∂‡¶®‡¶ü‡¶æ ‡¶ñ‡ßÅ‡¶¨ ‡¶ú‡¶∞‡ßÅ‡¶∞‡¶ø ‡¶´‡¶æ‡¶á‡¶≤ ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø
    permissions:
      contents: write

    steps:
      - name: Checkout Code
        uses: actions/checkout@v3

      - name: Setup Node
        uses: actions/setup-node@v3
        with:
          node-version: '18'

      - name: Install Libs
        run: npm install

      - name: Run Script
        env:
          FIREBASE_SERVICE_ACCOUNT: ${{ secrets.FIREBASE_SERVICE_ACCOUNT }}
          RAPIDAPI_KEYS_LIST: ${{ secrets.RAPIDAPI_KEYS_LIST }}
        run: node auto-sync.js

      # üî• ‡¶è‡¶á ‡¶®‡¶§‡ßÅ‡¶® ‡¶∏‡ßç‡¶ü‡ßá‡¶™‡¶ü‡¶ø data.json ‡¶´‡¶æ‡¶á‡¶≤‡¶ü‡¶ø ‡¶ó‡¶ø‡¶ü‡¶π‡¶æ‡¶¨‡ßá ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡¶¨‡ßá
      - name: Commit and Push JSON Data
        run: |
          git config --global user.name "GitHub Action"
          git config --global user.email "action@github.com"
          git add data.json
          # ‡¶Ø‡¶¶‡¶ø ‡¶´‡¶æ‡¶á‡¶≤‡ßá ‡¶ï‡ßã‡¶®‡ßã ‡¶ö‡ßá‡¶û‡ßç‡¶ú ‡¶®‡¶æ ‡¶•‡¶æ‡¶ï‡ßá, ‡¶§‡¶æ‡¶π‡¶≤‡ßá ‡¶è‡¶∞‡¶∞ ‡¶¶‡ßá‡¶¨‡ßá ‡¶®‡¶æ (|| exit 0)
          git commit -m "Auto-update match data.json [skip ci]" || exit 0
          git push
